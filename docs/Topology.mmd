flowchart TB

%% ============================
%% AZURE (TOP)
%% ============================
subgraph AZ["Azure (201.x)"]
  direction TB

  AZ_TAG["Azure Site (201.x)"]

  AZ_EXT["AZ-EXTERNAL<br><br>AZ-WAN<br>201.255.0.0/24<br><br>eth1 AZ-WAN 201.255.0.2/24<br>eth2 AZ-EXT 201.254.0.2/24<br><br>AZ-EXT<br>201.254.0.0/24"]
  AZ_EDGE["AZ-EDGE<br><br>AZ-EXT<br>201.254.0.0/24<br><br>eth1 AZ-EXT 201.254.0.1/24<br>eth2 AZ-DREN 100.255.0.1/24<br>eth3 AZ-CORE 201.0.0.2/24<br><br>AZ-CORE<br>201.0.0.0/24"]
  AZ_CORE["AZ-CORE<br><br>AZ-CORE<br>201.0.0.0/24<br><br>eth1 AZ-CORE 201.0.0.1/24<br>eth2 SDPC 201.0.1.1/24<br>eth3 SDPG 201.0.2.1/24<br>eth4 SDPT 201.0.3.1/24"]

  AZ_EXT --> AZ_EDGE --> AZ_CORE

  subgraph AZ_DOWN["Downstream routers"]
    direction LR
    AZ_INSIDE["INSIDE<br><br>eth1 AZ-CORE 201.0.0.3/24<br><br>DOMAIN 201.1.0.1/24<br>DOMSVC 201.1.1.1/24<br>AVD 201.1.2.1/24"]
    AZ_DEV["AZ-DEVELOPER<br><br>eth1 AZ-CORE 201.0.0.4/24<br><br>DEV 201.2.0.1/24<br>DEVSVC 201.2.1.1/24"]
    AZ_SEG1["AZ-SEGMENT1<br><br>eth1 AZ-CORE 201.0.0.5/24<br><br>SEG 201.3.0.1/24<br>HWIL 201.3.1.1/24"]
  end

  AZ_CORE -->|Downstream| AZ_INSIDE
  AZ_CORE -->|Downstream| AZ_DEV
  AZ_CORE -->|Downstream| AZ_SEG1

  %% LANs as rectangles
  AZ_DOMAIN_NET["DOMAIN<br>201.1.0.0/24"]
  AZ_DOMSVC_NET["DOMSVC<br>201.1.1.0/24"]
  AZ_AVD_NET["AVD<br>201.1.2.0/24"]
  AZ_DEV_NET["DEV<br>201.2.0.0/24"]
  AZ_DEVSVC_NET["DEVSVC<br>201.2.1.0/24"]
  AZ_SEG_NET["SEG<br>201.3.0.0/24"]
  AZ_HWIL_NET["HWIL<br>201.3.1.0/24"]

  AZ_INSIDE -->|DOMAIN eth2| AZ_DOMAIN_NET
  AZ_INSIDE -->|DOMSVC eth3| AZ_DOMSVC_NET
  AZ_INSIDE -->|AVD eth4| AZ_AVD_NET
  AZ_DEV -->|DEV eth2| AZ_DEV_NET
  AZ_DEV -->|DEVSVC eth3| AZ_DEVSVC_NET
  AZ_SEG1 -->|SEG eth2| AZ_SEG_NET
  AZ_SEG1 -->|HWIL eth3| AZ_HWIL_NET
end

%% ============================
%% DREN (Middle)
%% ============================
DREN["DREN<br>100.255.0.0/24<br>ALLOW: ICMP, 443/TCP+UDP, 53/UDP"]

%% ============================
%% ON-PREM (BOTTOM)
%% ============================
subgraph ONP["On-Prem (202.x)"]
  direction TB

  ONP_TAG["On-Prem Site (202.x)"]

  ONP_EDGE["ONP EDGE<br><br>ONP-EXT<br>202.254.0.0/24<br><br>eth1 ONP-EXT 202.254.0.1/24<br>eth2 ONP-DREN 100.255.0.2/24<br>eth3 ONP-CORE 202.0.0.2/24<br><br>ONP-CORE<br>202.0.0.0/24"]
  ONP_CORE["ONP CORE<br><br>eth1 ONP-CORE 202.0.0.1/24<br><br>SDPC 202.0.1.1/24<br>SDPG 202.0.2.1/24<br>SDPT 202.0.3.1/24"]

  ONP_EDGE --> ONP_CORE

  subgraph ONP_DOWN["Downstream routers"]
    direction LR
    ONP_INSIDE["ONP INSIDE<br><br>eth1 ONP-CORE 202.0.0.3/24<br><br>DOMAIN 202.1.0.1/24<br>DOMSVC 202.1.1.1/24<br>AVD 202.1.2.1/24"]
    ONP_DEV["ONP DEVELOPER<br><br>eth1 ONP-CORE 202.0.0.4/24<br><br>DEV 202.2.0.1/24<br>DEVSVC 202.2.1.1/24"]
    ONP_SEG1["ONP SEGMENT1<br><br>eth1 ONP-CORE 202.0.0.5/24<br><br>SEG 202.3.0.1/24<br>HWIL 202.3.1.1/24"]
  end

  ONP_CORE -->|Downstream| ONP_INSIDE
  ONP_CORE -->|Downstream| ONP_DEV
  ONP_CORE -->|Downstream| ONP_SEG1

  %% LANs as rectangles
  ONP_DOMAIN_NET["DOMAIN<br>202.1.0.0/24"]
  ONP_DOMSVC_NET["DOMSVC<br>202.1.1.0/24"]
  ONP_AVD_NET["AVD<br>202.1.2.0/24"]
  ONP_DEV_NET["DEV<br>202.2.0.0/24"]
  ONP_DEVSVC_NET["DEVSVC<br>202.2.1.0/24"]
  ONP_SEG_NET["SEG<br>202.3.0.0/24"]
  ONP_HWIL_NET["HWIL<br>202.3.1.0/24"]

  ONP_INSIDE -->|DOMAIN eth2| ONP_DOMAIN_NET
  ONP_INSIDE -->|DOMSVC eth3| ONP_DOMSVC_NET
  ONP_INSIDE -->|AVD eth4| ONP_AVD_NET
  ONP_DEV -->|DEV eth2| ONP_DEV_NET
  ONP_DEV -->|DEVSVC eth3| ONP_DEVSVC_NET
  ONP_SEG1 -->|SEG eth2| ONP_SEG_NET
  ONP_SEG1 -->|HWIL eth3| ONP_HWIL_NET
end

%% DREN links (dashed)
AZ_EDGE -.->|DREN transit| DREN -.->|DREN transit| ONP_EDGE

%% ============================
%% STYLES
%% ============================
classDef azRouter fill:#e8f2ff,stroke:#1f4b99,stroke-width:2px;
classDef onpRouter fill:#fff3e6,stroke:#9a5a00,stroke-width:2px;
classDef netNode fill:#f3f4f6,stroke:#6b7280,stroke-width:1px;
classDef drenNode fill:#ffe9e9,stroke:#e11d48,stroke-width:3px;
classDef siteTagAz fill:#dbeafe,stroke:#1f4b99,stroke-width:2px;
classDef siteTagOnp fill:#ffedd5,stroke:#9a5a00,stroke-width:2px;

class AZ_TAG siteTagAz;
class ONP_TAG siteTagOnp;

class AZ_EXT,AZ_EDGE,AZ_CORE,AZ_INSIDE,AZ_DEV,AZ_SEG1 azRouter;
class ONP_EDGE,ONP_CORE,ONP_INSIDE,ONP_DEV,ONP_SEG1 onpRouter;

class AZ_DOMAIN_NET,AZ_DOMSVC_NET,AZ_AVD_NET,AZ_DEV_NET,AZ_DEVSVC_NET,AZ_SEG_NET,AZ_HWIL_NET netNode;
class ONP_DOMAIN_NET,ONP_DOMSVC_NET,ONP_AVD_NET,ONP_DEV_NET,ONP_DEVSVC_NET,ONP_SEG_NET,ONP_HWIL_NET netNode;

class DREN drenNode;
